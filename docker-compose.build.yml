version: "3.9"

services:
  api_gateway:
    profiles:
      - all
      - api-gateway
    image: instill/${API_GATEWAY_HOST}:latest
    build:
      context: ./${API_GATEWAY_HOST}
      args:
        SERVICE_NAME: ${API_GATEWAY_HOST}
        GOLANG_VERSION: ${GOLANG_VERSION}
        ALPINE_VERSION: ${ALPINE_VERSION}
        KRAKEND_CE_VERSION: ${KRAKEND_CE_VERSION}

  pipeline_backend:
    profiles:
      - all
      - pipeline
    image: instill/${PIPELINE_BACKEND_HOST}:latest
    build:
      context: ./${PIPELINE_BACKEND_HOST}
      args:
        SERVICE_NAME: ${PIPELINE_BACKEND_HOST}
        GOLANG_VERSION: ${GOLANG_VERSION}
        K6_VERSION: ${K6_VERSION}

  connector_backend:
    profiles:
      - all
      - connector
    image: instill/${CONNECTOR_BACKEND_HOST}:latest
    build:
      context: ./${CONNECTOR_BACKEND_HOST}
      args:
        SERVICE_NAME: ${CONNECTOR_BACKEND_HOST}
        GOLANG_VERSION: ${GOLANG_VERSION}
        K6_VERSION: ${K6_VERSION}

  model_backend:
    profiles:
      - all
      - model
    image: instill/${MODEL_BACKEND_HOST}:latest
    build:
      context: ./${MODEL_BACKEND_HOST}
      args:
        SERVICE_NAME: ${MODEL_BACKEND_HOST}
        GOLANG_VERSION: ${GOLANG_VERSION}
        K6_VERSION: ${K6_VERSION}
        UBUNTU_VERSION: ${UBUNTU_VERSION}
        ARTIVC_VERSION: ${ARTIVC_VERSION}

  mgmt_backend:
    profiles:
      - all
      - mgmt
    image: instill/${MGMT_BACKEND_HOST}:latest
    build:
      context: ./${MGMT_BACKEND_HOST}
      args:
        SERVICE_NAME: ${MGMT_BACKEND_HOST}
        GOLANG_VERSION: ${GOLANG_VERSION}
        K6_VERSION: ${K6_VERSION}

  console:
    profiles:
      - all
      - console
    image: instill/${CONSOLE_HOST}:latest
    build:
      context: ./${CONSOLE_HOST}
