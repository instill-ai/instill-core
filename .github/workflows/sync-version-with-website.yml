# This workflow will open a PR in https://github.com/instill-ai/protobufs
# updating the API version in the OpenAPI specifications.

name: Sync release version with instill.tech website

on:
  push: 
  release:
    types: [published]

permissions:
  contents: read

jobs:
  update-website:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout instill.tech repository
      uses: actions/checkout@v4
      with:
        repository: instill-ai/instill.tech
        token: ${{ secrets.botGitHubToken }}
    - name: Modify the version in website
      run: |
        # On release triggers, GITHUB_REF_NAME is the release name (e.g.
        # 'v0.10.0-beta')
        sed -i "s/core: \".*\"/core: \"test\"/" version.mjs
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.botGitHubToken }}
        commit-message: 'chore: update  Instill Core version'
        title: 'docs(document): Update Instill Core version'
        body: Sync version with latest Core release
        branch: chore/update-api-version
        base: main
        draft: false
