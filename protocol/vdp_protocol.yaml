---
"$schema": http://json-schema.org/draft-07/schema#
"$id": https://github.com/instill-ai/vdp/blob/main/protocol/vdp_protocol.yaml
title: VDP Protocol
type: object
description: VDP Protocol structs
additionalProperties: true
anyOf:
  - required:
      - classification
  - required:
      - detection
  - required:
      - keypoint
  - required:
      - ocr
  - required:
      - instance_segmentation      
  - required:
      - unspecified
properties:
  classification:
    description: "Classify into pre-defined categories"
    "$ref": "#/definitions/Classification"
  detection:
    description: "Detect and localise multiple objects"
    "$ref": "#/definitions/Detection"
  keypoint:
    description: "Detect and localise keypoints of multiple objects"
    "$ref": "#/definitions/Keypoint"
  ocr:
    description: "Detect, localise and recognise texts"
    "$ref": "#/definitions/Ocr"
  instance_segmentation:
    description: "Detect and delineate each distinct object of interest appearing in an image"
    "$ref": "#/definitions/InstanceSegmentation"    
  unspecified:
    description: "Unspecified task with output in the free form"
    "$ref": "#/definitions/Unspecified"
definitions:
  Classification:
    type: object
    additionalProperties: false
    required:
      - category
      - score
    properties:
      category:
        description: "The predicted category of the input"
        type: string
      score:
        description: "The confidence score of the predicted category of the input"
        type: number
  Detection:
    type: object
    additionalProperties: false
    required:
      - objects
    properties:
      objects:
        description: "A list of detected objects"
        type: array
        items:
          type: object
          required:
            - bounding_box
            - category
            - score
          properties:
            bounding_box:
              "$ref": "#/definitions/BoundingBox"
            category:
              description: "The predicted category of the bounding box"
              type: string
            score:
              description: "The confidence score of the predicted category of the bounding box"
              type: number
  Keypoint:
    type: object
    additionalProperties: true
    required:
      - objects
    properties:
      objects:
        description: "A list of keypoint objects, a keypoint object includes all the pre-defined keypoints of a detected object"
        type: array
        items:
          type: object
          required:
            - keypoints
            - score
          properties:
            keypoints:
              description: "A keypoint group is composed of a list of pre-defined keypoints of a detected object"
              type: array
              items:
                type: object
                required:
                  - "x"
                  - "y"
                  - "v"
                properties:
                  x:
                    description: "x coordinate of the keypoint"
                    type: number
                  y:
                    description: "y coordinate of the keypoint"
                    type: number
                  v:
                    description: "visibility score of the keypoint"
                    type: number
            score:
              description: "The confidence score of the predicted object"
              type: number
  Ocr:
    type: object
    additionalProperties: false
    required:
      - objects
    properties:
      objects:
        description: "A list of detected bounding boxes"
        type: array
        items:
          type: object
          required:
            - bounding_box
            - text
            - score
          properties:
            bounding_box:
              "$ref": "#/definitions/BoundingBox"
            text:
              description: "Text string recognised per bounding box in the `bounding_boxes`"
              type: string
            score:
              description: "The confidence score of the predicted object"
              type: number
  InstanceSegmentation:
    type: object
    additionalProperties: false
    required:
      - objects
    properties:
      objects:
        description: "A list of detected instance bounding boxes"
        type: array
        items:
          type: object
          required:
            - rle
            - bounding_box
            - label
            - score
          properties:
            rle:
              description: Run Length Encoding (RLE) of instance mask within the bounding box
              type: string              
            bounding_box:
              "$ref": "#/definitions/BoundingBox"
            label:
              description: "Label text string recognised per bounding box in the `bounding_boxes`"
              type: string
            score:
              description: "The confidence score of the predicted instance object"
              type: number              
  Unspecified:
    type: object
    additionalProperties: false
    required:
      - raw_outputs
    properties:
      raw_outputs:
        description: "The raw output of the model"
        type: array
        items:
          type: object
          required:
            - name
            - data_type
            - shape
            - data
          properties:
            name:
              description: "The corresponding output name of the model output data"
              type: string
            data_type:
              description: "The type of the output data"
              type: string
            shape:
              description: "The shape of the output data"
              type: array
              items:
                type: integer
            data:
              description: "The output data"
              type: array
              items: {} # Allow any type
  BoundingBox:
    type: object
    description: "The detected bounding box in (top, left, width, height) format"
    additionalProperties: false
    required:
      - top
      - left
      - width
      - height
    properties:
      top:
        description: "Bounding box top y-axis value"
        type: number
      left:
        description: "Bounding box left x-axis value"
        type: number
      width:
        description: "Bounding box width value"
        type: number
      height:
        description: "Bounding box height value"
        type: number
