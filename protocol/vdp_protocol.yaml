---
"$schema": http://json-schema.org/draft-07/schema#
"$id": https://github.com/instill-ai/vdp/blob/main/protocol/vdp_protocol.yaml
title: VDP Protocol
type: object
description: VDP Protocol structs
additionalProperties: true
oneOf:
  - required:
      - classification
  - required:
      - detection
  - required:
      - keypoint
  - required:
      - ocr
  - required:
      - instance_segmentation
  - required:
      - semantic_segmentation
  - required:
      - text_to_image
  - required:
      - text_generation
  - required:
      - unspecified
properties:
  classification:
    description: "Classify an image into pre-defined categories"
    "$ref": "#/definitions/Classification"
  detection:
    description: "Detect and localise multiple objects"
    "$ref": "#/definitions/Detection"
  keypoint:
    description: "Detect and localise keypoints of multiple objects"
    "$ref": "#/definitions/Keypoint"
  ocr:
    description: "Detect, localise and recognise texts"
    "$ref": "#/definitions/Ocr"
  instance_segmentation:
    description: "Detect, localise and delineate multiple objects"
    "$ref": "#/definitions/InstanceSegmentation"
  semantic_segmentation:
    description: "Classify image pixels into predefined categories"
    "$ref": "#/definitions/SemanticSegmentation"
  text_to_image:
    description: "Generates images from input text"
    "$ref": "#/definitions/TextToImage"
  text_generation:
    description: "Generate new texts from input text"
    "$ref": "#/definitions/TextGeneration"
  unspecified:
    description: "Unspecified task with output in the free form"
    "$ref": "#/definitions/Unspecified"
definitions:
  Classification:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        "$ref": "#/definitions/BatchImage"
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - category
            - score
          properties:
            category:
              description: "The predicted category of the input"
              type: string
            score:
              description: "The confidence score of the predicted category of the input"
              type: number
  Detection:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        "$ref": "#/definitions/BatchImage"
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - objects
          properties:
            objects:
              description: "A list of detected objects"
              type: array
              items:
                type: object
                additionalProperties: false
                required:
                  - boundingBox
                  - category
                  - score
                properties:
                  boundingBox:
                    "$ref": "#/definitions/BoundingBox"
                  category:
                    description: "The predicted category of the bounding box"
                    type: string
                  score:
                    description: "The confidence score of the predicted category of the bounding box"
                    type: number
  Keypoint:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        "$ref": "#/definitions/BatchImage"
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - objects
          properties:
            objects:
              description: "A list of keypoint objects, a keypoint object includes all the pre-defined keypoints of a detected object"
              type: array
              items:
                type: object
                required:
                  - keypoints
                  - score
                properties:
                  keypoints:
                    description: "A keypoint group is composed of a list of pre-defined keypoints of a detected object"
                    type: array
                    items:
                      type: object
                      required:
                        - "x"
                        - "y"
                        - "v"
                      properties:
                        x:
                          description: "x coordinate of the keypoint"
                          type: number
                        y:
                          description: "y coordinate of the keypoint"
                          type: number
                        v:
                          description: "visibility score of the keypoint"
                          type: number
                  score:
                    description: "The confidence score of the predicted object"
                    type: number
  Ocr:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        "$ref": "#/definitions/BatchImage"
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - objects
          properties:
            objects:
              description: "A list of detected bounding boxes"
              type: array
              items:
                type: object
                required:
                  - boundingBox
                  - text
                  - score
                properties:
                  boundingBox:
                    "$ref": "#/definitions/BoundingBox"
                  text:
                    description: "Text string recognised per bounding box"
                    type: string
                  score:
                    description: "The confidence score of the predicted object"
                    type: number
  InstanceSegmentation:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        "$ref": "#/definitions/BatchImage"
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - objects
          properties:
            objects:
              description: "A list of detected instance bounding boxes"
              type: array
              items:
                type: object
                required:
                  - rle
                  - boundingBox
                  - category
                  - score
                properties:
                  rle:
                    description: Run Length Encoding (RLE) of instance mask within the bounding box
                    type: string
                  boundingBox:
                    "$ref": "#/definitions/BoundingBox"
                  category:
                    description: "The predicted category of the bounding box"
                    type: string
                  score:
                    description: "The confidence score of the predicted instance object"
                    type: number
  SemanticSegmentation:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        "$ref": "#/definitions/BatchImage"
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - stuffs
          properties:
            stuffs:
              description: "A list of RLE binary masks"
              type: array
              items:
                type: object
                required:
                  - rle
                  - category
                properties:
                  rle:
                    description: Run Length Encoding (RLE) of each stuff mask within the image
                    type: string
                  category:
                    description: "Category text string corresponding to each stuff mask"
                    type: string
  TextToImage:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - prompt
          properties:
            prompt:
              description: "The prompt text to generate images"
              type: string
            steps:
              description: "The steps to generate the final images (default 5)"
              type: number
            cfgScale:
              description: "Classifier Free Guidance (CFG) Scale is a measure of how close you want the model to stick to the prompt when looking for a related image to generate (default 7.5)"
              type: number
            negativePrompt:
              description: 'Negative prompt specifies what content should not be in the generated images (default "")'
              type: string
            seed:
              description: "The random seed to generate images (default 0)"
              type: number
            samples:
              description: "The number of generated images (default 1)"
              type: number
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - images
          properties:
            images:
              description: "A list of generated images"
              type: array
              items:
                description: "Generated image string in Base64 format"
                type: string
  TextGeneration:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - prompt
          properties:
            prompt:
              description: "The prompt text to generate text"
              type: string
            outputLength:
              description: "The maximum number of tokens for model to generate"
              type: number
            badWordsList:
              description: "The words not to avoid being generated by the model"
              type: string
            stopWordsList:
              description: "The trigger words to stop generation"
              type: string
            topk:
              description: "Top k for sampling"
              type: number
            seed:
              description: "The random seed to generate text"
              type: number
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - text
          properties:
            text:
              description: "Generated text string"
              type: string
  Unspecified:
    type: object
    additionalProperties: false
    oneOf:
      - required:
          - input
      - required:
          - output
    properties:
      input:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - data
          properties:
            data:
              description: "The input data"
              type: object
      output:
        type: array
        items:
          type: object
          additionalProperties: false
          required:
            - name
            - data_type
            - shape
            - data
          properties:
            name:
              description: "The corresponding output name of the model output data"
              type: string
            data_type:
              description: "The type of the output data"
              type: string
            shape:
              description: "The shape of the output data"
              type: array
              items:
                type: integer
            data:
              description: "The output data"
              type: array
              items: {} # Allow any type
  BatchImage:
    type: array
    items:
      type: object
      additionalProperties: false
      anyOf:
        - required:
            - url
        - required:
            - base64
      properties:
        url:
          description: "The URL of the input image"
          type: string
        base64:
          description: "The Base64 encoded string of the input image"
          type: string
  BoundingBox:
    type: object
    description: "The detected bounding box in (left, top, width, height) format"
    additionalProperties: false
    required:
      - left
      - top
      - width
      - height
    properties:
      left:
        description: "Bounding box left x-axis value"
        type: number
      top:
        description: "Bounding box top y-axis value"
        type: number
      width:
        description: "Bounding box width value"
        type: number
      height:
        description: "Bounding box height value"
        type: number